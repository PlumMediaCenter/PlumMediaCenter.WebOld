function fetchConstants(){var e=angular.injector(["ng"]),t=e.get("$http"),r=e.get("$q"),n=[r(function(e,r){t.get("api/GetEnumerations.php").then(function(t){angular.module("app").constant("enums",t.data),e()},r)})];return r.all(n)}function bootstrapApplication(){angular.element(document).ready(function(){angular.bootstrap(document,["app"])})}function notify(e,t){return t=t?t:"warning",t="danger"===t?"error":t,new PNotify({title:"",text:e,styling:"bootstrap3",type:t})}angular.module("app",["ui.router","ui.bootstrap","infinite-scroll"]).run(["$rootScope","enums","globals",function(e,t,r){e.enums=t,e.globals=r}]),fetchConstants().then(bootstrapApplication),angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/home"),e.state("home",{url:"/home",templateUrl:"app/partials/home.html",controller:"HomeController",controllerAs:"vm"}).state("admin",{url:"/admin",templateUrl:"app/partials/admin.html",controller:"AdminController",controllerAs:"vm"}).state("videoInfo",{url:"/videoInfo/{videoId:int}",templateUrl:"app/partials/videoInfo.html",controller:"VideoInfoController",controllerAs:"vm"}).state("videoSources",{url:"/videoSources",templateUrl:"app/partials/videoSources.html",controller:"VideoSourcesController",controllerAs:"vm"}).state("editVideoSource",{url:"/editVideoSource/{id:int}",parent:"videoSources",templateUrl:"app/partials/editVideoSource.html",controller:"EditVideoSourceController",controllerAs:"vm"}).state("play",{url:"/play/{videoId:int}?{showVideoId:int}",templateUrl:"app/partials/play.html",controller:"PlayController",controllerAs:"vm"}).state("search",{url:"/search?q",templateUrl:"app/partials/search.html",controller:"SearchController",controllerAs:"vm"}).state("metadataFetcher",{url:"/metadataFetcher/{videoId:int}",templateUrl:"app/partials/metadataFetcher.html",controller:"MetadataFetcherController",controllerAs:"vm"})}]).run(["$rootScope","$state","$stateParams",function(e,t,r){e.$state=t,e.$stateParams=r}]),angular.module("app").controller("AdminController",["$timeout","$window","globals","api","notify","Video","admin",function(e,t,r,n,o,i,a){function s(){o("Generating library","info");r.generateLibraryIsPending=!0,n.generateLibrary().then(function(){o("Library has been generated","success")}).catch(function(e){o('There was an error generating the library: "'+e.message+'"',"danger")}).finally(function(){r.generateLibraryIsPending=!1,l()})}function c(){a.getServerVersionNumber().then(function(e){p.serverVersionNumber=e})}function l(){i.getCounts().then(function(e){p.videoCounts=e})}function d(){r.fetchMissingMetadataIsPending=!0,o("Fetching missing metadata","info"),i.fetchMissingMetadata().then(function(){o("Finished fetching missing metata for videos","success")},function(){o("There was an error fetching missing metadata","error")}).finally(function(){r.fetchMissingMetadataIsPending=!1})}function u(){r.checkForUpdatesIsPending=!0,o("Checking for updates. Please wait until this operation has completed","info"),a.updateApplication().then(function(r){r.updateWasApplied?(o("Application has been updated. Reloading page.","success"),e(function(){t.location.reload()},4e3)):o("No updates were found","success")},function(){o("Unable to check and install updates","error")}).finally(function(){r.checkForUpdatesIsPending=!1})}r.title="Admin";var p=angular.extend(this,{serverVersionNumber:void 0,fetchMissingMetadata:d,generateLibrary:s,updateApplication:u});l(),c()}]),angular.module("app").controller("BaseController",["globals",function(e){angular.extend(this,{globals:e})}]),angular.module("app").controller("EditVideoSourceController",["$scope","globals","VideoSource","$state","$stateParams","enums",function(e,t,r,n,o,i){function a(){o.id&&o.id>0&&(l.isLoading=!0,r.getById(o.id).then(function(e){l.videoSource=e,l.originalVideoSource=angular.copy(e)}).finally(function(){l.isLoading=!1}))}function s(){l.videoSource=l.originalVideoSource,l.form.setPristine(!0)}function c(){l.isSaving=!0,r.save(l.videoSource).then(function(){l.isSaving=!1,a(),notify("Saved video source","success"),n.go("videoSources",{},{reload:!0})},function(){l.isSaving=!1})}var l=angular.extend(this,{isLoading:!1,isSaving:!1,originalVideoSource:void 0,videoSource:{securityType:i.securityType.public},reset:s,save:c,sayHi:function(){alert("hi")}});t.title="Edit Video Source",l.originalVideoSource=angular.copy(l.videoSource),a()}]),angular.module("app").controller("FetchByTitleController",["$stateParams",function(e){var t=angular.extend(this,{title:void 0});t.title=e.title}]),angular.module("app").controller("HomeController",["globals","Video",function(e,t){function r(){var t=e.infiniteScrollPageSize,r=n.currentlyLoadedVideos.length,o=r+t;o=o>n.allVideos.length?n.allVideos.length:o;for(var i=r;o>i;i++)n.currentlyLoadedVideos.push(n.allVideos[i])}var n=angular.extend(this,{allVideos:[],currentlyLoadedVideos:[],loadMore:r});e.title="Home",t.getAll().then(function(e){n.allVideos=e})}]),angular.module("app").controller("MetadataFetcherController",["$scope","$q","globals","refreshImage","Video","$state","$stateParams","notify","enums",function(e,t,r,n,o,i,a,s,c){function l(){f.calculateTextboxLabel(),f.searchValue=f.searchBy===f.searchByOptions.title?f.video.title:""}function d(){f.textboxLabel=void 0,f.video&&(f.textboxLabel=f.searchBy===f.searchByOptions.title?"Title":f.video.mediaType===c.mediaTypeMovie?"TMDB ID":"TVDB ID")}function u(){f.isSearching=!0;var e;e=f.searchBy===f.searchByOptions.title?o.getMetadataSearchResultsByTitle(f.video.mediaType,f.searchValue):o.getMetadataSearchResultsByOnlineVideoId(f.video.mediaType,f.searchValue),e.then(function(e){f.metadataResults=e,f.isSearching=!1})}function p(e){f.metadataIsBeingFetched=!0,o.fetchMetadata(f.video.videoId,e).then(function(){return o.getById(f.video.videoId)}).then(function(e){return n(e.sdPosterUrl).then(function(){return n(e.hdPosterUrl)}).then(function(){return void setTimeout(function(){window.location.reload()},200)})}).then(function(){f.metadataResults=void 0,f.metadataIsBeingFetched=!1,s("Updated video with selected metadata","success"),i.go("videoInfo",{videoId:f.videoId})})["catch"](function(e){f.metadataIsBeingFetched=!1,s("There was an error fetching metadata for the video you selected: "+e,"error")})}r.title="Fetch Metadata";var f=angular.extend(this,{searchByOptions:{onlineVideoId:"onlineVideoId",title:"title"},videoId:a.videoId,searchBy:"onlineVideoId",isSearching:!1,metadataIsBeingFetched:!1,textboxLabel:void 0,searchValue:void 0,searchResults:void 0,video:{},search:u,calculateTextboxLabel:d,fetchMetadataByOnlineVideoId:p});e.$watch("vm.searchBy",l),e.$watch("vm.video",f.calculateTextboxLabel),o.getById(f.videoId).then(function(e){angular.extend(f.video,e),l()}),o.getPathInfo(f.videoId).then(function(e){angular.extend(f.video,e)})}]),angular.module("app").controller("NavbarController",["$state",function(e){function t(){i.searchTerm&&i.searchTerm.trim().length>0&&(e.go("search",{q:i.searchTerm}),i.searchTerm=void 0,n())}function r(){i.navbarIsOpen=!0}function n(){i.navbarIsOpen=!1}function o(){i.navbarIsOpen?n():r()}var i=angular.extend(this,{searchTerm:void 0,navbarIsOpen:!1,search:t,hideNavbar:n,toggleNavbar:o})}]),angular.module("app").controller("PlayController",["$scope","globals","$stateParams","notify",function(e,t,r){t.title="Play",t.hideNavbar=!0;angular.extend(this,{videoId:r.videoId,showVideoId:r.showVideoId});e.$on("$destroy",function(){t.hideNavbar=!1})}]),angular.module("app").controller("SearchController",["globals","Video","$stateParams",function(e,t,r){function n(){var t=e.infiniteScrollPageSize,r=o.currentlyLoadedVideos.length,n=r+t;n=n>o.allVideos.length?o.allVideos.length:n;for(var i=r;n>i;i++){var a=o.allVideos[i];o.currentlyLoadedVideos.push(a)}}var o=angular.extend(this,{allVideos:[],currentlyLoadedVideos:[],searchTerm:r.q,loadMore:n});e.title="Home";var i=r.q;t.search(i).then(function(e){o.allVideos=e})}]),angular.module("app").controller("VideoInfoController",["$scope","globals","Video","$state","$stateParams","enums",function(e,t,r,n,o,i){function a(){var e=_.pluck(l.episodes,"videoId");r.getProgressPercentMultiple(e).then(function(e){for(var t in e){var r=e[t],n=_.where(l.episodes,{videoId:r.videoId})[0];n&&(n.percentWatched=r.percent)}})}function s(){return l.progressPercent<40?"danger":l.progressPercent<99?"warning":l.progressPercent<101?"success":void 0}function c(){r.getShowFromEpisodeId(l.videoId).then(function(e){n.go("videoInfo",{videoId:e.videoId})})}var l=angular.extend(this,{progressPercent:0,preventCache:o.preventCache,episodes:void 0,videoId:o.videoId,getProgressPercentType:s,navigateToShow:c});t.title="VideoInfo",e.$watch("vm.episodes",a),r.getById(l.videoId).then(function(e){l.video=e,l.video.mediaType===i.mediaType.show&&r.getEpisodes(l.video.videoId).then(function(e){l.episodes=e}).then(function(){return r.getNextEpisode(l.video.videoId)}).then(function(e){l.nextEpisode=_.where(l.episodes,{videoId:e.videoId})[0]}).then(function(){return r.getProgressPercent(l.nextEpisode.videoId)}).then(function(e){l.nextEpisode.percentWatched=e}),r.getProgressPercent(l.video.videoId).then(function(e){l.progressPercent=e})})}]),angular.module("app").controller("VideoSourcesController",["globals","VideoSource","notify",function(e,t){function r(){t.getAll().then(function(e){o.videoSources=e})}function n(e){t.deleteById(e).then(r)}var o=this;o.editIsVisible=!1,o.deleteVideoSource=n,o.refresh=r,e.title="Video Sources",r()}]),angular.module("app").service("Video",["$http","$q","_",function(e,t,r){function n(){}return n.search=function(r){var n=t.defer();return e.get("api/GetSearchResults.php",{params:{q:r}}).success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},n.getAll=function(){return t(function(t){e.get("api/GetLibrary.php").success(function(e){t(e)})})},n.getById=function(n){var o=t.defer();return r.isNumber(n)?e.get("api/GetVideo.php?videoId="+n).success(function(e){o.resolve(e)}).error(function(){o.reject(data)}):o.reject(),o.promise},n.getEpisodes=function(r){var n=t.defer();return e.get("api/GetTvEpisodes.php?videoId="+r).success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},n.getNextEpisode=function(r){var n=t.defer();return e.get("api/GetNextEpisode.php?videoId="+r).success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},n.getProgressPercent=function(r){var n=t.defer();return e.get("api/GetVideoProgressPercent.php",{params:{videoId:r}}).success(function(e){n.resolve(e.percent)}).error(n.reject),n.promise},n.getProgressPercentMultiple=function(n){n=r.isArray(n)?n:[];var o=t.defer();return e.get("api/GetVideoProgressPercentMultiple.php",{params:{videoIds:n.join(",")}}).success(function(e){o.resolve(e)}).error(o.reject),o.promise},n.getProgress=function(r){var n=t.defer();return e.get("api/GetVideoProgress.php",{params:{videoId:r}}).success(function(e){n.resolve(e.startSeconds)}).error(function(){n.reject()}),n.promise},n.setProgress=function(r,n,o){o=o===!0?!0:!1;var i=t.defer();return e.get("api/SetVideoProgress.php",{params:{videoId:r,seconds:n,finished:o}}).success(function(e){e.success?i.resolve():i.reject()}).error(function(){i.reject()}),i.promise},n.getCounts=function(){var r=t.defer();return e.get("api/GetVideoCounts.php").success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},n.fetchMetadata=function(r,n){var o=t.defer();return e.get("api/FetchVideoMetadata.php",{params:{videoId:r,onlineVideoId:n}}).success(function(e){o.resolve(e)}).error(function(){o.reject()}),o.promise},n.getMetadataSearchResultsByTitle=function(r,n){var o=t.defer();return e.get("api/GetMetadataSearchResults.php",{params:{mediaType:r,title:n}}).success(function(e){o.resolve(e)}).error(function(){o.reject()}),o.promise},n.getMetadataSearchResultsByOnlineVideoId=function(r,n){var o=t.defer();return e.get("api/GetMetadataSearchResults.php",{params:{mediaType:r,onlineVideoId:n}}).success(function(e){o.resolve(e)}).error(function(){o.reject()}),o.promise},n.getPathInfo=function(r){var n=t.defer();return e.get("api/GetVideoPathInfo.php?videoId="+r).success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},n.getShowFromEpisodeId=function(r){var n=t.defer();return e.get("api/GetTvShowByEpisodeId.php?videoId="+r).success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},n.fetchMissingMetadata=function(){var r=t.defer();return e.get("api/FetchMissingMetadataAndPosters.php").success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},n}]),angular.module("app").service("VideoSource",["$http","$q",function(e,t){function r(){}return r.getAll=function(){var r=t.defer();return e.get("api/GetVideoSources.php").success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.getById=function(r){var n=t.defer();return e.get("api/GetVideoSourceById.php?id="+r).success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},r.save=function(r){return t(function(t,n){e.post("api/PostVideoSource.php",r).then(function(e){t(e.data)},n)})},r.deleteById=function(r){return t(function(t,n){e.delete("api/DeleteVideoSource.php",{data:{id:r}}).then(function(e){t(e.data)},n)})},r}]),angular.module("app").service("admin",["$http","$q","_",function(e,t){function r(){var r=t.defer();return e.get("api/GetServerVersionNumber.php").success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise}function n(){var r=t.defer();return e.get("api/Update.php").success(function(e){e.success===!0?r.resolve(e):r.reject(e)}).error(function(e){r.reject(e)}),r.promise}return{getServerVersionNumber:r,updateApplication:n}}]),angular.module("app").service("api",["$q","$http",function(e,t){function r(){return e(function(e,r){t.get("api/GenerateLibrary.php").success(function(t){t.success?e():r()}).error(function(){r()})})}return{generateLibrary:r}}]),angular.module("app").service("globals",[function(){return{pageTitle:"PlumMediaCenter",hideNavbar:!1,infiniteScrollPageSize:25,fetchMissingMetadataIsPending:!1,generateLibraryIsPending:!1,checkForUpdatesIsPending:!1}}]),angular.module("app").service("_",function(){return window._}),angular.module("app").service("notify",function(){return notify}),angular.module("app").service("refreshImage",["$q",function(e){function t(t){var r=e.defer(),n=function(){this.contentWindow.location.reload(!0),this.removeEventListener("load",n,!1),this.parentElement.removeChild(this),r.resolve()},o=document.createElement("iframe");return o.style.display="none",o.addEventListener("load",n,!1),o.addEventListener("error",r.reject,!1),o.src=t,document.body.appendChild(o),r.promise}return t}]),angular.module("app").service("uniqueId",[function(){var e=0;return function(){return e++,"element-"+e}}]),angular.module("app").service("util",["_",function(e){function t(t){if(e.isArray(t))for(;t.length>0;)t.pop();else for(var r in t)delete t[r]}return{blankItemInPlace:t}}]),angular.module("app").directive("confirm",[function(){return{restrict:"A",link:function(e,t,r){t.on("click",function(){var t=e.$eval(r.confirmMessage);t=t?t:"Are you sure you want to do that?";var n=confirm(t);n&&e.$eval(r.confirm)})}}}]),angular.module("app").directive("focus",["$timeout","$parse",function(e,t){return{restrict:"A",link:function(r,n,o){r.$watch(function(){return r.$eval(o.focus)},function(i){i===!0&&e(function(){n[0].focus(),getter=t(o.focus),getter.assign(r,!1)})})}}}]),angular.module("app").directive("jwplayer",["uniqueId",function(e){function t(e,t,r){function n(){u.player.play()}function o(){u.player.play(!0)}function i(){u.player.pause(!1)}function a(e){r.blankItemInPlace(u.playlist),e&&(u.playlist.push({file:e.url,image:e.posterUrl,title:e.title,video:e}),u.jwplayer?u.player.load(u.playlist):(jwplayer(u.elementId).setup({flashplayer:"lib/jwplayer-6.11/jwplayer.flash.swf",primary:"html5",playlist:u.playlist,startparam:"start",wmode:"transparent",width:"100%",height:"100%",events:{onTime:s,onPlay:d,onComplete:c},autostart:!0}),u.player=jwplayer(u.elementId)))}function s(t){if(v===!1&&t.position>0)return v=!0,void l();var r=t.position,n=new Date,o=n-f;o>5e3&&(f=new Date,e.setProgress(u.video.videoId,r))}function c(){console.debug("Finished playing video "+u.video.videoId),e.setProgress(u.video.videoId,-1,!0)}function l(){p>0&&(u.player.seek(p),console.debug("seeking to ",p))}function d(){f=new Date}var u=this;angular.extend(this,{play:o,pause:i,playlist:[],loadVideo:a,togglePlayback:n});var p=0,f=new Date;e.getById(u.videoId).then(function(t){e.getProgress(u.videoId).then(function(e){u.video=t,p=e})}),t.$watch("vm.video",u.loadVideo),t.$on("$destroy",function(){jwplayer(u.elementId).remove()});var v=!1}return{restrict:"E",replace:!0,controllerAs:"vm",controller:["Video","$scope","util",t],bindToController:!0,scope:{videoId:"="},link:function(t,r,n,o){o.elementId=r.attr("id"),o.playlist=[{file:"http://localhost:8080/videos/movies/A%20Good%20Day%20to%20Die%20Hard/A%20Good%20Day%20to%20Die%20Hard.mp4"}],o.elementId||(o.elementId=e()),r.attr("id",o.elementId)},template:'<div class="jwplayer"></div>'}}]),angular.module("app").directive("videoTile",[function(){function e(){}return{restrict:"E",controllerAs:"vm",controller:[e],bindToController:!0,scope:{video:"="},templateUrl:"app/directives/videoTileDirective.html"}}]),angular.module("app").directive("pathExistsValidator",function(e,t){return{require:"ngModel",link:function(r,n,o,i){i.$asyncValidators.pathExists=function(r,n){var o=r||n;return e.get("api/GetPathExistsOnServer.php",{params:{path:o}}).then(function(e){return!e.data.exists==!0?t.reject(e.data.errorMessage):!0})}}}}),angular.module("app").directive("urlExistsValidator",function(e,t){return{require:"ngModel",link:function(r,n,o,i){i.$asyncValidators.urlExists=function(r,n){var o=r||n;return e.get("api/GetUrlExists.php",{params:{url:o}}).then(function(e){return!e.data.exists==!0?t.reject(e.data.errorMessage):!0})}}}});
//# sourceMappingURL=app.min.js.map