function fetchConstants(){var e=angular.injector(["ng"]),t=e.get("$http"),n=e.get("$q"),r=[n(function(e,n){t.get("api/GetEnumerations.php").then(function(t){angular.module("app").constant("enums",t.data),e()},n)})];return n.all(r)}function bootstrapApplication(){angular.element(document).ready(function(){angular.bootstrap(document,["app"])})}function notify(e,t){return t=t?t:"warning",t="danger"===t?"error":t,new PNotify({title:"",text:e,styling:"bootstrap3",type:t})}angular.module("app",["ui.router","ui.bootstrap","infinite-scroll"]).run(["$rootScope","enums","globals",function(e,t,n){e.enums=t,e.globals=n}]),fetchConstants().then(bootstrapApplication),angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/home"),e.state("addNewMediaItem",{url:"/addNewMediaItem",templateUrl:"addNewMediaItem.html",controller:"AddNewMediaItemController",controllerAs:"vm"}).state("home",{url:"/home",templateUrl:"home.html",controller:"HomeController",controllerAs:"vm"}).state("admin",{url:"/admin",templateUrl:"admin.html",controller:"AdminController",controllerAs:"vm"}).state("videoInfo",{url:"/videoInfo/{videoId:int}",templateUrl:"videoInfo.html",controller:"VideoInfoController",controllerAs:"vm"}).state("videoSources",{url:"/videoSources",templateUrl:"videoSources.html",controller:"VideoSourcesController",controllerAs:"vm"}).state("editVideoSource",{url:"/editVideoSource/{id:int}",parent:"videoSources",templateUrl:"editVideoSource.html",controller:"EditVideoSourceController",controllerAs:"vm"}).state("play",{url:"/play/{videoId:int}?{showVideoId:int}",templateUrl:"play.html",controller:"PlayController",controllerAs:"vm"}).state("search",{url:"/search?q",templateUrl:"search.html",controller:"SearchController",controllerAs:"vm"}).state("metadataFetcher",{url:"/metadataFetcher/{videoId:int}",templateUrl:"metadataFetcher.html",controller:"MetadataFetcherController",controllerAs:"vm"})}]).run(["$rootScope","$state","$stateParams",function(e,t,n){e.$state=t,e.$stateParams=n}]),angular.module("app").controller("AddNewMediaItemController",["Video","globals","VideoSource","notify",function(e,t,n,r){function o(){e.addNewMediaItem(i.newMediaItem.videoSourceId,i.newMediaItem.path).then(function(e){r("New media items were successfully added","success")},function(e){r(e.message,"danger")})}t.title="Add new media item";var i=angular.extend(this,{videoSources:[],newMediaItem:{},addNewMediaItem:o});n.getAll().then(function(e){i.videoSources=e})}]),angular.module("app").controller("AdminController",["$timeout","$window","globals","api","notify","Video","admin",function(e,t,n,r,o,i,a){function s(){o("Generating library","info");n.generateLibraryIsPending=!0,r.generateLibrary().then(function(){o("Library has been generated","success")})["catch"](function(e){o('There was an error generating the library: "'+e.message+'"',"danger")})["finally"](function(){n.generateLibraryIsPending=!1,l()})}function d(){a.getServerVersionNumber().then(function(e){p.serverVersionNumber=e})}function l(){i.getCounts().then(function(e){p.videoCounts=e})}function c(){n.fetchMissingMetadataIsPending=!0,o("Fetching missing metadata","info"),i.fetchMissingMetadata().then(function(){o("Finished fetching missing metata for videos","success")},function(){o("There was an error fetching missing metadata","error")})["finally"](function(){n.fetchMissingMetadataIsPending=!1})}function u(){n.checkForUpdatesIsPending=!0,o("Checking for updates. Please wait until this operation has completed","info"),a.updateApplication().then(function(n){n.updateWasApplied?(o("Application has been updated. Reloading page.","success"),e(function(){t.location.reload()},4e3)):o("No updates were found","success")},function(){o("Unable to check and install updates","error")})["finally"](function(){n.checkForUpdatesIsPending=!1})}n.title="Admin";var p=angular.extend(this,{serverVersionNumber:void 0,fetchMissingMetadata:c,generateLibrary:s,updateApplication:u});l(),d()}]),angular.module("app").controller("BaseController",["globals",function(e){angular.extend(this,{globals:e})}]),angular.module("app").controller("EditVideoSourceController",["$scope","globals","VideoSource","$state","$stateParams","enums",function(e,t,n,r,o,i){function a(){o.id&&o.id>0&&(l.isLoading=!0,n.getById(o.id).then(function(e){l.videoSource=e,l.originalVideoSource=angular.copy(e)})["finally"](function(){l.isLoading=!1}))}function s(){l.videoSource=l.originalVideoSource,l.form.setPristine(!0)}function d(){l.isSaving=!0,n.save(l.videoSource).then(function(e){l.isSaving=!1,a(),notify("Saved video source","success"),r.go("videoSources",{},{reload:!0})},function(){l.isSaving=!1})}var l=angular.extend(this,{isLoading:!1,isSaving:!1,originalVideoSource:void 0,videoSource:{securityType:i.securityType["public"]},reset:s,save:d,sayHi:function(){alert("hi")}});t.title="Edit Video Source",l.originalVideoSource=angular.copy(l.videoSource),a()}]),angular.module("app").controller("FetchByTitleController",["$stateParams",function(e){var t=angular.extend(this,{title:void 0});t.title=e.title}]),angular.module("app").controller("HomeController",["globals","Video",function(e,t){function n(){var t=e.infiniteScrollPageSize,n=r.currentlyLoadedVideos.length,o=n+t;o=o>r.allVideos.length?r.allVideos.length:o;for(var i=n;o>i;i++)r.currentlyLoadedVideos.push(r.allVideos[i])}var r=angular.extend(this,{allVideos:[],currentlyLoadedVideos:[],loadMore:n});e.title="Home",t.getAll().then(function(e){r.allVideos=e})}]),angular.module("app").controller("MetadataFetcherController",["$scope","$q","globals","refreshImage","Video","$state","$stateParams","notify","enums",function(e,t,n,r,o,i,a,s,d){function l(){f.calculateTextboxLabel(),f.searchBy===f.searchByOptions.title?f.searchValue=f.video.title:f.searchValue=""}function c(){f.textboxLabel=void 0,f.video&&(f.searchBy===f.searchByOptions.title?f.textboxLabel="Title":f.textboxLabel=f.video.mediaType===d.mediaTypeMovie?"TMDB ID":"TVDB ID")}function u(){f.isSearching=!0;var e;e=f.searchBy===f.searchByOptions.title?o.getMetadataSearchResultsByTitle(f.video.mediaType,f.searchValue):o.getMetadataSearchResultsByOnlineVideoId(f.video.mediaType,f.searchValue),e.then(function(e){f.metadataResults=e,f.isSearching=!1})}function p(e){f.metadataIsBeingFetched=!0,o.fetchMetadata(f.video.videoId,e).then(function(){return o.getById(f.video.videoId)}).then(function(e){return r(e.sdPosterUrl).then(function(){return r(e.hdPosterUrl)}).then(function(){return void setTimeout(function(){window.location.reload()},200)})}).then(function(){f.metadataResults=void 0,f.metadataIsBeingFetched=!1,s("Updated video with selected metadata","success"),i.go("videoInfo",{videoId:f.videoId})})["catch"](function(e){f.metadataIsBeingFetched=!1,s("There was an error fetching metadata for the video you selected: "+e,"error")})}n.title="Fetch Metadata";var f=angular.extend(this,{searchByOptions:{onlineVideoId:"onlineVideoId",title:"title"},videoId:a.videoId,searchBy:"onlineVideoId",isSearching:!1,metadataIsBeingFetched:!1,textboxLabel:void 0,searchValue:void 0,searchResults:void 0,video:{},search:u,calculateTextboxLabel:c,fetchMetadataByOnlineVideoId:p});e.$watch("vm.searchBy",l),e.$watch("vm.video",f.calculateTextboxLabel),o.getById(f.videoId).then(function(e){angular.extend(f.video,e),l()}),o.getPathInfo(f.videoId).then(function(e){angular.extend(f.video,e)})}]),angular.module("app").controller("NavbarController",["$state",function(e){function t(){i.searchTerm&&i.searchTerm.trim().length>0&&(e.go("search",{q:i.searchTerm}),i.searchTerm=void 0,r())}function n(){i.navbarIsOpen=!0}function r(){i.navbarIsOpen=!1}function o(){i.navbarIsOpen?r():n()}var i=angular.extend(this,{searchTerm:void 0,navbarIsOpen:!1,search:t,hideNavbar:r,toggleNavbar:o})}]),angular.module("app").controller("PlayController",["$scope","globals","$stateParams","notify",function(e,t,n,r){t.title="Play",t.hideNavbar=!0;angular.extend(this,{videoId:n.videoId,showVideoId:n.showVideoId});e.$on("$destroy",function(){t.hideNavbar=!1})}]),angular.module("app").controller("SearchController",["globals","Video","$stateParams",function(e,t,n){function r(){var t=e.infiniteScrollPageSize,n=o.currentlyLoadedVideos.length,r=n+t;r=r>o.allVideos.length?o.allVideos.length:r;for(var i=n;r>i;i++){var a=o.allVideos[i];o.currentlyLoadedVideos.push(a)}}var o=angular.extend(this,{allVideos:[],currentlyLoadedVideos:[],searchTerm:n.q,loadMore:r});e.title="Home";var i=n.q;t.search(i).then(function(e){o.allVideos=e})}]),angular.module("app").controller("VideoInfoController",["$scope","globals","Video","$state","$stateParams","enums",function(e,t,n,r,o,i){function a(){var e=_.pluck(l.episodes,"videoId");n.getProgressPercentMultiple(e).then(function(e){for(var t in e){var n=e[t],r=_.where(l.episodes,{videoId:n.videoId})[0];r&&(r.percentWatched=n.percent)}})}function s(){return l.progressPercent<40?"danger":l.progressPercent<99?"warning":l.progressPercent<101?"success":void 0}function d(){n.getShowFromEpisodeId(l.videoId).then(function(e){r.go("videoInfo",{videoId:e.videoId})})}var l=angular.extend(this,{progressPercent:0,preventCache:o.preventCache,episodes:void 0,videoId:o.videoId,getProgressPercentType:s,navigateToShow:d});t.title="VideoInfo",e.$watch("vm.episodes",a),n.getById(l.videoId).then(function(e){l.video=e,l.video.mediaType===i.mediaType.show&&n.getEpisodes(l.video.videoId).then(function(e){l.episodes=e}).then(function(){return n.getNextEpisode(l.video.videoId)}).then(function(e){l.nextEpisode=_.where(l.episodes,{videoId:e.videoId})[0]}).then(function(){return n.getProgressPercent(l.nextEpisode.videoId)}).then(function(e){l.nextEpisode.percentWatched=e}),n.getProgressPercent(l.video.videoId).then(function(e){l.progressPercent=e})})}]),angular.module("app").controller("VideoSourcesController",["globals","VideoSource","notify",function(e,t,n){function r(){t.getAll().then(function(e){i.videoSources=e})}function o(e){t.deleteById(e).then(r)}var i=this;i.editIsVisible=!1,i.deleteVideoSource=o,i.refresh=r,e.title="Video Sources",r()}]),angular.module("app").directive("confirm",[function(){return{restrict:"A",link:function(e,t,n,r){t.on("click",function(){var t=e.$eval(n.confirmMessage);t=t?t:"Are you sure you want to do that?";var r=confirm(t);r&&e.$eval(n.confirm)})}}}]),angular.module("app").directive("episode",[function(){function e(){var e=angular.extend(this,{},this),t=16;if(e.title=e.episode.title,e.episode.title.length>t&&(e.title=e.episode.title.substring(0,t)+"..."),"number"==typeof e.episode.runtime&&e.episode.runtime>-1){var n=parseInt(e.episode.runtime/60);e.runtimeText="("+n+" min)"}}return{restrict:"E",scope:{episode:"="},controller:e,controllerAs:"vm",bindToController:!0,link:function(e,t,n,r){},templateUrl:"episodeDirective.html"}}]),angular.module("app").directive("focus",["$timeout","$parse",function(e,t){return{restrict:"A",link:function(n,r,o,i){n.$watch(function(){return n.$eval(o.focus)},function(i){i===!0&&e(function(){r[0].focus(),getter=t(o.focus),getter.assign(n,!1)})})}}}]),angular.module("app").directive("jwplayer",["uniqueId",function(e){function t(e,t,n){function r(){u.player.play()}function o(){u.player.play(!0)}function i(){u.player.pause(!1)}function a(e){n.blankItemInPlace(u.playlist),e&&(u.playlist.push({file:e.url,image:e.posterUrl,title:e.title,video:e}),u.jwplayer?u.player.load(u.playlist):(jwplayer(u.elementId).setup({flashplayer:"lib/jwplayer-6.11/jwplayer.flash.swf",primary:"html5",playlist:u.playlist,startparam:"start",wmode:"transparent",width:"100%",height:"100%",events:{onTime:s,onPlay:c,onComplete:d},autostart:!0}),u.player=jwplayer(u.elementId)))}function s(t){if(v===!1&&t.position>0)return v=!0,void l();var n=t.position,r=new Date,o=r-f;o>5e3&&(f=new Date,e.setProgress(u.video.videoId,n))}function d(){console.debug("Finished playing video "+u.video.videoId),e.setProgress(u.video.videoId,-1,!0)}function l(){p>0&&(u.player.seek(p),console.debug("seeking to ",p))}function c(){f=new Date}var u=this;angular.extend(this,{play:o,pause:i,playlist:[],loadVideo:a,togglePlayback:r});var p=0,f=new Date;e.getById(u.videoId).then(function(t){e.getProgress(u.videoId).then(function(e){u.video=t,p=e})}),t.$watch("vm.video",u.loadVideo),t.$on("$destroy",function(){jwplayer(u.elementId).remove()});var v=!1}return{restrict:"E",replace:!0,controllerAs:"vm",controller:["Video","$scope","util",t],bindToController:!0,scope:{videoId:"="},link:function(t,n,r,o){o.elementId=n.attr("id"),o.playlist=[{file:"http://localhost:8080/videos/movies/A%20Good%20Day%20to%20Die%20Hard/A%20Good%20Day%20to%20Die%20Hard.mp4"}],o.elementId||(o.elementId=e()),n.attr("id",o.elementId)},template:'<div class="jwplayer"></div>'}}]),angular.module("app").directive("videoTile",[function(){function e(){}return{restrict:"E",controllerAs:"vm",controller:[e],bindToController:!0,scope:{video:"="},templateUrl:"videoTileDirective.html"}}]),angular.module("app").service("admin",["$http","$q","_",function(e,t,n){function r(){var n=t.defer();return e.get("api/GetServerVersionNumber.php").success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise}function o(){var n=t.defer();return e.get("api/Update.php").success(function(e){e.success===!0?n.resolve(e):n.reject(e)}).error(function(e){n.reject(e)}),n.promise}return{getServerVersionNumber:r,updateApplication:o}}]),angular.module("app").service("api",["$q","$http",function(e,t){function n(){return e(function(e,n){t.get("api/GenerateLibrary.php").success(function(t){t.success?e():n()}).error(function(){n()})})}return{generateLibrary:n}}]),angular.module("app").service("globals",[function(){return{pageTitle:"PlumMediaCenter",hideNavbar:!1,infiniteScrollPageSize:25,fetchMissingMetadataIsPending:!1,generateLibraryIsPending:!1,checkForUpdatesIsPending:!1}}]),angular.module("app").service("_",function(){return window._}),angular.module("app").service("notify",function(){return notify}),angular.module("app").service("refreshImage",["$q",function(e){function t(t){var n=e.defer(),r=function(){this.contentWindow.location.reload(!0),this.removeEventListener("load",r,!1),this.parentElement.removeChild(this),n.resolve()},o=document.createElement("iframe");return o.style.display="none",o.addEventListener("load",r,!1),o.addEventListener("error",n.reject,!1),o.src=t,document.body.appendChild(o),n.promise}return t}]),angular.module("app").service("uniqueId",[function(){var e=0;return function(){return e++,"element-"+e}}]),angular.module("app").service("util",["_",function(e){function t(t){if(e.isArray(t))for(;t.length>0;)t.pop();else for(var n in t)delete t[n]}return{blankItemInPlace:t}}]),angular.module("app").service("Video",["$http","$q","_",function(e,t,n){function r(){}return r.search=function(n){var r=t.defer();return e.get("api/GetSearchResults.php",{params:{q:n}}).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.getAll=function(){return t(function(t,n){e.get("api/GetLibrary.php").success(function(e){t(e)})})},r.getById=function(r){var o=t.defer();return n.isNumber(r)?e.get("api/GetVideo.php?videoId="+r).success(function(e){o.resolve(e)}).error(function(){o.reject(data)}):o.reject(),o.promise},r.getEpisodes=function(n){var r=t.defer();return e.get("api/GetTvEpisodes.php?videoId="+n).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.getNextEpisode=function(n){var r=t.defer();return e.get("api/GetNextEpisode.php?videoId="+n).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.getProgressPercent=function(n){var r=t.defer();return e.get("api/GetVideoProgressPercent.php",{params:{videoId:n}}).success(function(e){r.resolve(e.percent)}).error(r.reject),r.promise},r.getProgressPercentMultiple=function(r){r=n.isArray(r)?r:[];var o=t.defer();return e.get("api/GetVideoProgressPercentMultiple.php",{params:{videoIds:r.join(",")}}).success(function(e){o.resolve(e)}).error(o.reject),o.promise},r.getProgress=function(n){var r=t.defer();return e.get("api/GetVideoProgress.php",{params:{videoId:n}}).success(function(e){r.resolve(e.startSeconds)}).error(function(){r.reject()}),r.promise},r.setProgress=function(n,r,o){o=o===!0?!0:!1;var i=t.defer();return e.get("api/SetVideoProgress.php",{params:{videoId:n,seconds:r,finished:o}}).success(function(e){e.success?i.resolve():i.reject()}).error(function(){i.reject()}),i.promise},r.getCounts=function(){var n=t.defer();return e.get("api/GetVideoCounts.php").success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},r.fetchMetadata=function(n,r){var o=t.defer();return e.get("api/FetchVideoMetadata.php",{params:{videoId:n,onlineVideoId:r}}).success(function(e){o.resolve(e)}).error(function(){o.reject()}),o.promise},r.getMetadataSearchResultsByTitle=function(n,r){var o=t.defer();return e.get("api/GetMetadataSearchResults.php",{params:{mediaType:n,title:r}}).success(function(e){o.resolve(e)}).error(function(){o.reject()}),o.promise},r.getMetadataSearchResultsByOnlineVideoId=function(n,r){var o=t.defer();return e.get("api/GetMetadataSearchResults.php",{params:{mediaType:n,onlineVideoId:r}}).success(function(e){o.resolve(e)}).error(function(){o.reject()}),o.promise},r.getPathInfo=function(n){var r=t.defer();return e.get("api/GetVideoPathInfo.php?videoId="+n).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.getShowFromEpisodeId=function(n){var r=t.defer();return e.get("api/GetTvShowByEpisodeId.php?videoId="+n).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.fetchMissingMetadata=function(){var n=t.defer();return e.get("api/FetchMissingMetadataAndPosters.php").success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},r.addNewMediaItem=function(t,n){return e.get("api/AddNewMediaItem.php",{params:{videoSourceId:t,path:n}}).success(function(e){return e}).error(function(e){return e})},r}]),angular.module("app").service("VideoSource",["$http","$q",function(e,t){function n(){}return n.getAll=function(){var n=t.defer();return e.get("api/GetVideoSources.php").success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},n.getById=function(n){var r=t.defer();return e.get("api/GetVideoSourceById.php?id="+n).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},n.save=function(n){return t(function(t,r){e.post("api/PostVideoSource.php",n).then(function(e){t(e.data)},r)})},n.deleteById=function(n){return t(function(t,r){e["delete"]("api/DeleteVideoSource.php",{data:{id:n}}).then(function(e){t(e.data)},r)})},n}]),angular.module("app").directive("pathExistsValidator",["$http","$q",function(e,t){return{require:"ngModel",link:function(n,r,o,i){i.$asyncValidators.pathExists=function(n,r){var o=n||r;return e.get("api/GetPathExistsOnServer.php",{params:{path:o}}).then(function(e){return!e.data.exists==!0?t.reject(e.data.errorMessage):!0})}}}}]),angular.module("app").directive("urlExistsValidator",["$http","$q",function(e,t){return{require:"ngModel",link:function(n,r,o,i){i.$asyncValidators.urlExists=function(n,r){var o=n||r;return e.get("api/GetUrlExists.php",{params:{url:o}}).then(function(e){return!e.data.exists==!0?t.reject(e.data.errorMessage):!0},function(e){})}}}}]);
//# sourceMappingURL=app.min.js.map